% extends "base.html"

% block scripts
<script src="/assets/vendor/vue/js/vue.js"></script>
% endblock

{% block bodyattrs %}vocab="${config.VOCAB_IRI}" id="editor"{% endblock %}

% block content
<!DOCTYPE html>
<meta charset="utf-8" />


<div id="editorApp">
  <h1><small>Redigererar:</small><br>{{thing.prefLabel || thing['@id']}}</h1>
  <ul>
    <template v-for="(k, v) in thing">
      <li>
        <span class="label">{{ k }}</span>
        <span class="value">
          <data-node :key="k" :value="v" :index="linked"></data-node>
        </span>
        <button v-if="isArray(v)" v-on:click="addItem(k)">+</button>
      </li>
    </template>
  </ul>
  <div id="result">
    <h2>JSON</h2>
    <textarea v-model="thing | json">
    </textarea>
  </div>
  <hr>
  <button id="saveButton" v-on:click="saveItem()" v-bind:class="{ 'fail' : saved.status == 'fail', 'success' : saved.status == 'success' }">
    <i class="fa fa-fw fa-cog fa-spin" v-show="saved.loading"></i>
    <i class="fa fa-fw fa-close" v-show="saved.status == 'fail'"></i>
    <i class="fa fa-fw fa-check" v-show="saved.status == 'success'"></i>
    <i class="fa fa-fw fa-save" v-show="!saved.loading && saved.status == 'normal'"></i>
    Spara
  </button>
     - Senast uppdaterad: {{ thing.modified }}
  <hr>
</div>

<template id="data-node">
  <template v-if="!isMarc(key)">
    <template v-if="isArray(value)">
      <li>
        <ul>
          <data-node v-for="v in value" :value="v" :index="index"></data-node><br>
        </ul>
      </li>
    </template>
    <template v-if="!isArray(value) && !isPlainObject(value)">
      <li>
        <input value="{{value | json}}"></input>
      </li>
    </template>
    <template v-if="!isArray(value) && isPlainObject(value)">
      <li class="linked">
        <a href="{{value['@id']}}">{{getLinked(value['@id']).prefLabel || value['@id']}}</a> <i class="fa fa-close" v-on:click="removeItem($parent.key, value)"></i>
      </li>
    </template>
  </template>
  <template v-else>
    <code>{{value | json}}</code>
  </template>
</template>

<script id="data" type="application/json">${data|safe}</script>
<script id="model" type="application/json">${model|safe}</script>
% endblock
